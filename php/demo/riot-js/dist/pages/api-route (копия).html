<div id="tabs">
  <a href="/v2/ru/api/">Теги</a>
  <a href="/v2/ru/api/compiler/">Компилятор</a>
  <a href="/v2/ru/api/observable/">Наблюдатель</a>
  <a href="/v2/ru/api/route/" class="current">Маршрутизатор</a>
  <a href="/v2/ru/api/misc/">Разное</a>
</div>

<h1>API · Маршрутизатор</h1>

<div id="toc"><p><a href="#использование-роутера">Использование роутера</a></p><p><a href="#настройка">Настройка</a></p><p><a href="#-маршрутные-группы">Маршрутные группы</a></p><p><a href="#-прироритет-маршрутизации">Прироритет маршрутизации</a></p></div>

<p>Маршрутизатор Riot - одна из самых минималистичных реализаций маршрутизатора из всех, что вы можете найти. Он работает во  всех браузерах, включая IE9. В версии &lt;2.3 маршрутизатор отслеживает только хэш-часть URL (часть после символа <code class="highlighter-rouge">#</code>). Большинство одностраничных приложений работают только с хэш-частью, но, если вам нужно обрабатывать URL целиком, вам следует использовать другую реализацию маршрутизатора.</p>

<p>Маршрутизатор Riot без дополнительных настроек работает с иерархическими схемами, в которых части маршрута, разделены “/”. В этом случае Riot предоставляет прямой доступ к этим частям.</p>

<p>Маршрутизатор Riot - это минималистичный иструмент со следующийм функционалом:</p>

<ul>
  <li>pushState и history API</li>
  <li>группы маршрутизации</li>
  <li>заменяемый парсер</li>
  <li>совместимость с IE9 и выше</li>
</ul>

<h3 id="riotroutecallback">riot.route(callback)</h3>

<p>Функция <code class="highlighter-rouge">callback</code> выполняется каждый раз когда меняется хэш. Например:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">riot</span><span class="p">.</span><span class="nx">route</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">collection</span><span class="p">,</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">action</span><span class="p">)</span> <span class="p">{</span>

<span class="p">})</span>
</code></pre></div></div>

<p>Если, например, когда отностиельный URL изменится на <code class="highlighter-rouge">customers/987987/edit</code> тогда в примере выше, аргументы будут равны:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">collection</span> <span class="o">=</span> <span class="s1">'customers'</span>
<span class="nx">id</span> <span class="o">=</span> <span class="s1">'987987'</span>
<span class="nx">action</span> <span class="o">=</span> <span class="s1">'edit'</span>
</code></pre></div></div>

<p>URL может быть изменён следующими способами:</p>

<ol>
  <li>Ввод нового хэш через адресную строку</li>
  <li>Нажатие в браузере кнопки “вперёд” или “назад”</li>
  <li>Вызов <code class="highlighter-rouge">riot.route(to)</code></li>
  <li>Переход по ссылке</li>
</ol>

<h3 id="riotroutefilter-callback">riot.route(filter, callback)</h3>

<p><span class="tag red">&gt;= v2.3</span></p>

<p>Выполняет <code class="highlighter-rouge">callback</code> когда URL меняется и соответствует <code class="highlighter-rouge">filter</code>. Например:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// соответствует `/fruit`</span>
<span class="nx">riot</span><span class="p">.</span><span class="nx">route</span><span class="p">(</span><span class="s1">'/fruit'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'The list of fruits'</span><span class="p">)</span>
<span class="p">})</span>
</code></pre></div></div>

<p>Допускается использование <code class="highlighter-rouge">*</code> в <code class="highlighter-rouge">filter</code>:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// если URL изменится на `/fruit/apple`,</span>
<span class="c1">// это будет удовлетворять условие, и 'apple' будет содержаться в `name`</span>
<span class="nx">riot</span><span class="p">.</span><span class="nx">route</span><span class="p">(</span><span class="s1">'/fruit/*'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'The detail of '</span> <span class="o">+</span> <span class="nx">name</span><span class="p">)</span>
<span class="p">})</span>

<span class="c1">// если URL изменится на `/blog/2015-09/01`,</span>
<span class="c1">// то '2015', '09' и '01' заполнятся следующим образом:</span>
<span class="nx">riot</span><span class="p">.</span><span class="nx">route</span><span class="p">(</span><span class="s1">'/blog/*-*/*'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">year</span><span class="p">,</span> <span class="nx">month</span><span class="p">,</span> <span class="nx">date</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'The page of '</span> <span class="o">+</span> <span class="nx">year</span> <span class="o">+</span> <span class="s1">'-'</span> <span class="o">+</span> <span class="nx">month</span> <span class="o">+</span> <span class="s1">'-'</span> <span class="nx">date</span><span class="p">)</span>
<span class="p">})</span>
</code></pre></div></div>

<p>Если вы хотите отловить URL <code class="highlighter-rouge">/old</code> и <code class="highlighter-rouge">/old/and/anything</code>, фильтр может быть записан как  <code class="highlighter-rouge">..</code>:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">riot</span><span class="p">.</span><span class="nx">route</span><span class="p">(</span><span class="s1">'/old..'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'The pages under /old was moved.'</span><span class="p">)</span>
<span class="p">})</span>
</code></pre></div></div>

<p>Это может быть полезным, когда в URL используются GET-параметры</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// если URL изменится на `/search?keyword=Apple`, то это будет удовлетворять фильтр</span>
<span class="nx">riot</span><span class="p">.</span><span class="nx">route</span><span class="p">(</span><span class="s1">'/search..'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">q</span> <span class="o">=</span> <span class="nx">riot</span><span class="p">.</span><span class="nx">route</span><span class="p">.</span><span class="nx">query</span><span class="p">()</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Search keyword: '</span> <span class="o">+</span> <span class="nx">q</span><span class="p">.</span><span class="nx">keyword</span><span class="p">)</span>
<span class="p">})</span>

<span class="c1">// это может быть записано так</span>
<span class="c1">// но учтите, что `*` может соответствовать только цифре, букве или нижнему подчёркиванию</span>
<span class="nx">riot</span><span class="p">.</span><span class="nx">route</span><span class="p">(</span><span class="s1">'/search?keyword=*'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">keyword</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Search keyword: '</span> <span class="o">+</span> <span class="nx">keyword</span><span class="p">)</span>
<span class="p">})</span>
</code></pre></div></div>

<p><span class="tag red">Внимание:</span> Riot использует следующие регулярные выражения:</p>

<ul>
  <li><code class="highlighter-rouge">*</code>: <code class="highlighter-rouge">([^/?#]+?)</code></li>
  <li><code class="highlighter-rouge">..</code>: <code class="highlighter-rouge">.*</code></li>
</ul>

<h3 id="riotroutecreate">riot.route.create()</h3>

<p><span class="tag red">&gt;= v2.3</span></p>

<p>Возвращает новый контекст маршрутизатора. Например:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">subRoute</span> <span class="o">=</span> <span class="nx">riot</span><span class="p">.</span><span class="nx">route</span><span class="p">.</span><span class="nx">create</span><span class="p">()</span>
<span class="nx">subRoute</span><span class="p">(</span><span class="s1">'/fruit/apple'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="cm">/* */</span> <span class="p">})</span>
</code></pre></div></div>

<p>Смотрите так же <a href="#routing-group">маршрутные группы</a> и <a href="#routing-priority">приоритет маршрутизации</a>.</p>

<h2 id="использование-роутера">Использование роутера</h2>

<h3 id="riotrouteto-title">riot.route(to[, title])</h3>

<p>Меняет URL в браузере и уведомляет об этом всех обработчиков, которые были созданы через <code class="highlighter-rouge">riot.route(callback)</code>. Например:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">riot</span><span class="p">.</span><span class="nx">route</span><span class="p">(</span><span class="s1">'customers/267393/edit'</span><span class="p">)</span>
</code></pre></div></div>
<p>Начиная с v2.3, вы можете так же указать заголовок страницы:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">riot</span><span class="p">.</span><span class="nx">route</span><span class="p">(</span><span class="s1">'customers/267393/edit'</span><span class="p">,</span> <span class="s1">'Editing customer page'</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="riotroutestartautoexec">riot.route.start(autoExec)</h3>

<p>Начинает прослушивать события и выполняет маршрутизацию, соответствующую текущему URL.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">riot</span><span class="p">.</span><span class="nx">route</span><span class="p">.</span><span class="nx">start</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
</code></pre></div></div>

<p>Это сокращение для:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">riot</span><span class="p">.</span><span class="nx">route</span><span class="p">.</span><span class="nx">start</span><span class="p">()</span>
<span class="nx">riot</span><span class="p">.</span><span class="nx">route</span><span class="p">.</span><span class="nx">exec</span><span class="p">()</span>
</code></pre></div></div>

<h3 id="riotroutestop">riot.route.stop()</h3>

<p>Остановка всех маршрутизаторов. Этот метод удаляет все обработчики.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">riot</span><span class="p">.</span><span class="nx">route</span><span class="p">.</span><span class="nx">stop</span><span class="p">()</span>
</code></pre></div></div>

<p>Обычно, этот метод используется вместе с <a href="#riot-route-start">riot.route.start</a>. Например:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">riot</span><span class="p">.</span><span class="nx">route</span><span class="p">.</span><span class="nx">stop</span><span class="p">()</span> <span class="c1">// удаляет все старые обработчики</span>
<span class="nx">riot</span><span class="p">.</span><span class="nx">route</span><span class="p">.</span><span class="nx">start</span><span class="p">()</span> <span class="c1">// старует новую маршрутизацию</span>
</code></pre></div></div>

<h3 id="subroutestop">subRoute.stop()</h3>

<p><span class="tag red">&gt;= v2.3</span></p>

<p>Аналогично <code class="highlighter-rouge">riot.route.stop()</code>, но только для отдельного маршрута.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">subRoute</span> <span class="o">=</span> <span class="nx">riot</span><span class="p">.</span><span class="nx">route</span><span class="p">.</span><span class="nx">create</span><span class="p">()</span>
<span class="nx">subRoute</span><span class="p">(</span><span class="s1">'/fruit/apple'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="cm">/* */</span> <span class="p">})</span>
<span class="nx">subRoute</span><span class="p">.</span><span class="nx">stop</span><span class="p">()</span>
</code></pre></div></div>

<h3 id="riotrouteexec">riot.route.exec()</h3>

<p>Выполнение маршрутизации по тому URL, который сейчас в адресной строке, не дожидаясь изменений. Например:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">riot</span><span class="p">.</span><span class="nx">route</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="cm">/* логика маршрутизатора */</span> <span class="p">})</span>
<span class="nx">riot</span><span class="p">.</span><span class="nx">route</span><span class="p">.</span><span class="nx">exec</span><span class="p">()</span>
</code></pre></div></div>

<p><span class="tag red">Warning:</span> <code class="highlighter-rouge">riot.route.exec(callback)</code> не рекомендуется, начиная с <code class="highlighter-rouge">v2.3</code>.</p>

<h3 id="riotroutequery">riot.route.query()</h3>

<p><span class="tag red">&gt;= v2.3</span></p>

<p>Вспомогательная функция для извлечения GET-параметров из URL.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// if the url change to `/search?keyword=Apple&amp;limit=30` this will match</span>
<span class="nx">riot</span><span class="p">.</span><span class="nx">route</span><span class="p">(</span><span class="s1">'/search..'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">q</span> <span class="o">=</span> <span class="nx">riot</span><span class="p">.</span><span class="nx">route</span><span class="p">.</span><span class="nx">query</span><span class="p">()</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Search keyword: '</span> <span class="o">+</span> <span class="nx">q</span><span class="p">.</span><span class="nx">keyword</span><span class="p">)</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Search limit: '</span> <span class="o">+</span> <span class="nx">q</span><span class="p">.</span><span class="nx">limit</span><span class="p">)</span>
<span class="p">})</span>
</code></pre></div></div>

<h2 id="настройка">Настройка</h2>

<h3 id="riotroutebasebase">riot.route.base(base)</h3>

<p>Изменение базовой части URL. Если у вас URL выглядти так:</p>

<p><code class="highlighter-rouge">http://riotexample.com/app/fruit/apple</code></p>

<p>Вы можете задать сделать <code class="highlighter-rouge">/app</code> базовым, тогда вы будете иметь дело только с <code class="highlighter-rouge">/fruit/apple</code>.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">riot</span><span class="p">.</span><span class="nx">route</span><span class="p">.</span><span class="nx">base</span><span class="p">(</span><span class="s1">'/app'</span><span class="p">)</span>
</code></pre></div></div>

<p>По умолчанию, базовым значением является “#”. Вы можете изменить это значение на <code class="highlighter-rouge">#!</code>:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">riot</span><span class="p">.</span><span class="nx">route</span><span class="p">.</span><span class="nx">base</span><span class="p">(</span><span class="s1">'#!'</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="riotrouteparserparser-secondparser">riot.route.parser(parser[, secondParser])</h3>

<p>Замена стандартного парсера на свой. Вот пример такого парсера:</p>

<p><code class="highlighter-rouge">!/user/activation?token=xyz</code></p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">riot</span><span class="p">.</span><span class="nx">route</span><span class="p">.</span><span class="nx">parser</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">raw</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="nx">split</span><span class="p">(</span><span class="s1">'?'</span><span class="p">),</span>
      <span class="nx">uri</span> <span class="o">=</span> <span class="nx">raw</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">split</span><span class="p">(</span><span class="s1">'/'</span><span class="p">),</span>
      <span class="nx">qs</span> <span class="o">=</span> <span class="nx">raw</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
      <span class="nx">params</span> <span class="o">=</span> <span class="p">{}</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">qs</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">qs</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">'&amp;'</span><span class="p">).</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">c</span> <span class="o">=</span> <span class="nx">v</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">'='</span><span class="p">)</span>
      <span class="nx">params</span><span class="p">[</span><span class="nx">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="nx">c</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="p">})</span>
  <span class="p">}</span>

  <span class="nx">uri</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">params</span><span class="p">)</span>
  <span class="k">return</span> <span class="nx">uri</span>
<span class="p">})</span>
</code></pre></div></div>

<p>Вот какие параметры распознает этот парсер:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">riot</span><span class="p">.</span><span class="nx">route</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">target</span><span class="p">,</span> <span class="nx">action</span><span class="p">,</span> <span class="nx">params</span><span class="p">)</span> <span class="p">{</span>

  <span class="cm">/*
    target = 'user'
    action = 'activation'
    params = { token: 'xyz' }
  */</span>

<span class="p">})</span>
</code></pre></div></div>

<h4 id="второй-парсер">Второй парсер</h4>

<p><span class="tag red">&gt;= v2.3</span></p>

<p>Вы также можете использовать <code class="highlighter-rouge">secondParser</code> для того, чтобы переопределить фильтр:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Так выглядит стандартный второй парсер</span>
<span class="kd">function</span> <span class="nx">second</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span> <span class="nx">filter</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">re</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="s1">'^'</span> <span class="o">+</span> <span class="nx">filter</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/</span><span class="se">\*</span><span class="sr">/g</span><span class="p">,</span> <span class="s1">'([^/?#]+?)'</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/</span><span class="se">\.\.</span><span class="sr">/</span><span class="p">,</span> <span class="s1">'.*'</span><span class="p">)</span> <span class="o">+</span> <span class="s1">'$'</span><span class="p">)</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">args</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">re</span><span class="p">))</span> <span class="k">return</span> <span class="nx">args</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="p">}</span>

<span class="nx">riot</span><span class="p">.</span><span class="nx">route</span><span class="p">.</span><span class="nx">parser</span><span class="p">(</span><span class="nx">first</span><span class="p">,</span> <span class="nx">second</span><span class="p">)</span>
</code></pre></div></div>

<p>Если парсер ничего не вернёт, будет использован следующий фильтр.</p>

<h2 id="-маршрутные-группы"><a name="routing-group"></a> Маршрутные группы</h2>

<p>Традиционный маршрутизатор на стороне сервера является высоко централизованным, но в последнее время мы часто используем маршрутизаторы на странице. Взляните на этот случай:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;first-tag&gt;</span>
  <span class="nt">&lt;p&gt;</span>First tag<span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;script&gt;</span>
    <span class="nx">riot</span><span class="p">.</span><span class="nx">route</span><span class="p">(</span><span class="s1">'/fruit/*'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
      <span class="cm">/* do something common */</span>
    <span class="p">})</span>
  <span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;/first-tag&gt;</span>

<span class="nt">&lt;second-tag&gt;</span>
  <span class="nt">&lt;p&gt;</span>Second tag<span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;script&gt;</span>
    <span class="nx">riot</span><span class="p">.</span><span class="nx">route</span><span class="p">(</span><span class="s1">'/fruit/apple'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
      <span class="cm">/* do something SPECIAL */</span>
    <span class="p">})</span>
  <span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;/second-tag&gt;</span>
</code></pre></div></div>

<p>Два тега имеют маршруты, и, вроде бы, выглядит нормально? Нет, это не будет работать. Потому что только один из маршрутизаторов должен сработать, но невозможно опрделить, какой из двух. Для этого, мы должны сделать группы маршрутизации для каждого тега. Например:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;first-tag&gt;</span>
  <span class="nt">&lt;p&gt;</span>First tag<span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;script&gt;</span>
    <span class="kd">var</span> <span class="nx">subRoute</span> <span class="o">=</span> <span class="nx">riot</span><span class="p">.</span><span class="nx">route</span><span class="p">.</span><span class="nx">create</span><span class="p">()</span> <span class="c1">// создаётся другой контекст</span>
    <span class="nx">subRoute</span><span class="p">(</span><span class="s1">'/fruit/*'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
      <span class="cm">/* делается что-то для ОБЩЕГО случая */</span>
    <span class="p">})</span>
  <span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;/first-tag&gt;</span>

<span class="nt">&lt;second-tag&gt;</span>
  <span class="nt">&lt;p&gt;</span>Second tag<span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;script&gt;</span>
    <span class="kd">var</span> <span class="nx">subRoute</span> <span class="o">=</span> <span class="nx">riot</span><span class="p">.</span><span class="nx">route</span><span class="p">.</span><span class="nx">create</span><span class="p">()</span> <span class="c1">// создаётся ещё один контекст</span>
    <span class="nx">subRoute</span><span class="p">(</span><span class="s1">'/fruit/apple'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
      <span class="cm">/* делается что-то для КОНКРЕТНОГО случая */</span>
    <span class="p">})</span>
  <span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;/second-tag&gt;</span>
</code></pre></div></div>

<h2 id="-прироритет-маршрутизации"><a name="routing-priority"></a> Прироритет маршрутизации</h2>

<p>Маршрутизатор выполняет обработчики по мере из определения. В случае ниже выполнится только первый и оставшиеся два никогда не сработают.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">riot</span><span class="p">.</span><span class="nx">route</span><span class="p">(</span><span class="s1">'/fruit/*'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span> <span class="cm">/* */</span> <span class="p">})</span> <span class="c1">// (1)</span>
<span class="nx">riot</span><span class="p">.</span><span class="nx">route</span><span class="p">(</span><span class="s1">'/fruit/apple'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="cm">/* */</span> <span class="p">})</span> <span class="c1">// (2)</span>
<span class="nx">riot</span><span class="p">.</span><span class="nx">route</span><span class="p">(</span><span class="s1">'/fruit/orange'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="cm">/* */</span> <span class="p">})</span> <span class="c1">// (3)</span>
</code></pre></div></div>

<p>Это будет работать:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">riot</span><span class="p">.</span><span class="nx">route</span><span class="p">(</span><span class="s1">'/fruit/apple'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="cm">/* */</span> <span class="p">})</span> <span class="c1">// (1)</span>
<span class="nx">riot</span><span class="p">.</span><span class="nx">route</span><span class="p">(</span><span class="s1">'/fruit/orange'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="cm">/* */</span> <span class="p">})</span> <span class="c1">// (2)</span>
<span class="nx">riot</span><span class="p">.</span><span class="nx">route</span><span class="p">(</span><span class="s1">'/fruit/*'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span> <span class="cm">/* */</span> <span class="p">})</span> <span class="c1">// (3)</span>
</code></pre></div></div>

<p>Маршруты <em>с фильтрами</em> имеют более высокий приоритет, чем маршруты без фильтра. Ниже маршруты пронумерованы в порядке очерёдности исполнения:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">riot</span><span class="p">.</span><span class="nx">route</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="cm">/* */</span> <span class="p">})</span> <span class="c1">// (3)</span>
<span class="nx">riot</span><span class="p">.</span><span class="nx">route</span><span class="p">(</span><span class="s1">'/fruit/*'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="cm">/* */</span> <span class="p">})</span> <span class="c1">// (1)</span>
<span class="nx">riot</span><span class="p">.</span><span class="nx">route</span><span class="p">(</span><span class="s1">'/sweet/*'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="cm">/* */</span> <span class="p">})</span> <span class="c1">// (2)</span>
</code></pre></div></div>