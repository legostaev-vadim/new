<div id="tabs">
  <?php get_menu($tabsApi); ?>
  <a target="_blank" href="https://riot.js.org/api/misc/">Разное</a>
</div>

<section class="apidoc">

<h1>API · Пользовательские теги</h1>

<div id="toc"><p><a href="#mounting">Монтирование</a></p><p><a href="#rendering">Рендеринг</a></p><p><a href="#tag-instance">Экземпляр тега</a></p><p><a href="#updating">Обновление</a></p><p><a href="#unmounting">Размонтирование</a></p><p><a href="#nested-tags">Вложенные теги</a></p><p><a href="#-yielding-nested-html">Встраивание HTML в тег</a></p><p><a href="#mixins">Примеси</a></p><p><a href="#events">События</a></p><p><a href="#reserved-words">Зарезервированные слова</a></p><p><a href="#manual-construction">Создание тега вручную</a></p></div>

<h2 id="mounting">Монтирование</h2>

<h3 id="-riotmountcustomtagselector-opts">
<a name="mount"></a> riot.mount(customTagSelector, [opts])</h3>

<p>Выбирает элементы со страницы <code class="highlighter-rouge">customTagSelector</code> и монтирует их как пользовательские теги. Имя выбранного элемента должно совпадать с именем пользовательского тега.</p>

<p><code class="highlighter-rouge">opts</code> - необязательный объект параметров, который передаётся в теги. Это может быть что угодно, начиная от простого объекта до большого API приложения. Или это может быть Flux-хранилище. Это зависит от того, как вы структурируете ваше приложение. Вы можете узнать больше о модульности <a href="guide-design#modularity">здесь</a>. <em>Обратите внимание,</em> что атрибуты монтируемого тега имеют более высокий приоритет над атрибутами, указанными с такими же именами через аргумент <code class="highlighter-rouge">opts</code>.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// выбрать и смонтировать все &lt;pricing&gt; теги на странице</span>
<span class="kd">var</span> <span class="nx">tags</span> <span class="o">=</span> <span class="nx">riot</span><span class="p">.</span><span class="nx">mount</span><span class="p">(</span><span class="s1">'pricing'</span><span class="p">)</span>

<span class="c1">// смонтировать все пользовательские теги с классом .customer</span>
<span class="kd">var</span> <span class="nx">tags</span> <span class="o">=</span> <span class="nx">riot</span><span class="p">.</span><span class="nx">mount</span><span class="p">(</span><span class="s1">'.customer'</span><span class="p">)</span>

<span class="c1">// смонтировать тег &lt;account&gt; и передать ему объект API в качестве параметра</span>
<span class="kd">var</span> <span class="nx">tags</span> <span class="o">=</span> <span class="nx">riot</span><span class="p">.</span><span class="nx">mount</span><span class="p">(</span><span class="s1">'account'</span><span class="p">,</span> <span class="nx">api</span><span class="p">)</span>
</code></pre></div></div>

<p>@returns: массив смонтированных <a href="#tag-instance">тегов</a></p>

<p>Примечание: при использовании <a href="guide-compiler#in-browser-compilation">компиляции в браузере</a> необходимо будет обернуть вызовы <code class="highlighter-rouge">riot.mount</code> в <code class="highlighter-rouge">riot.compile</code> для того, чтобы получить возвращаемые <a href="#tag-instance">экземпляры тегов</a>. Без этого, вызовы <code class="highlighter-rouge">riot.mount</code> будут возвращать <code class="highlighter-rouge">undefined</code>.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">riot</span><span class="p">.</span><span class="nx">compile</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// здесь теги компилируются и riot.mount работает синхронно</span>
  <span class="kd">var</span> <span class="nx">tags</span> <span class="o">=</span> <span class="nx">riot</span><span class="p">.</span><span class="nx">mount</span><span class="p">(</span><span class="s1">'*'</span><span class="p">)</span>
<span class="p">})</span>
</code></pre></div></div>

<p><span class="tag red">&gt;=3.12.0</span></p>

<p>Аргумент <code class="highlighter-rouge">opts</code> также может быть функцией, чтобы избежать совместного использования одного и того же объекта несколькими экземплярами тегов <a href="https://github.com/riot/riot/issues/2613">riot/2613</a></p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">riot</span><span class="p">.</span><span class="nx">mount</span><span class="p">(</span><span class="s1">'my-tag'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">{</span>
    <span class="na">custom</span><span class="p">:</span> <span class="s1">'option'</span>
  <span class="p">}</span>
<span class="p">})</span>
</code></pre></div></div>

<h3 id="-riotmount-opts">
<a name="mount-star"></a> riot.mount(‘*’, [opts])</h3>

<p>Специальный селектор Riot “*” используется для монтирования всех пользовательских тегов на странице:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">riot</span><span class="p">.</span><span class="nx">mount</span><span class="p">(</span><span class="s1">'*'</span><span class="p">)</span>
</code></pre></div></div>

<p>@returns: массив смонтированных <a href="#tag-instance">тегов</a></p>

<h3 id="-riotmountselector-tagname-opts">
<a name="mount-tag"></a> riot.mount(selector, tagName, [opts])</h3>

<p>Здесь</p>

<ul>
  <li>
<code class="highlighter-rouge">selector</code> выбирает любой элемент DOM, к которому будет примонтирован тег</li>
  <li>
<code class="highlighter-rouge">tagName</code> указывает имя используемого тега</li>
  <li>
<code class="highlighter-rouge">opts</code> необязательный объект, содержащий параметры</li>
</ul>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// монтирует тег "my-tag" в div#main и передаёт в него параметры из объекта api</span>
<span class="kd">var</span> <span class="nx">tags</span> <span class="o">=</span> <span class="nx">riot</span><span class="p">.</span><span class="nx">mount</span><span class="p">(</span><span class="s1">'div#main'</span><span class="p">,</span> <span class="s1">'my-tag'</span><span class="p">,</span> <span class="nx">api</span><span class="p">)</span>
</code></pre></div></div>

<p>@returns: массив смонтированных <a href="#tag-instance">тегов</a></p>

<h3 id="-riotmountdomnode-tagname-opts">
<a name="mount-dom"></a> riot.mount(domNode, tagName, [opts])</h3>

<p>Монтирует пользовательский тег tagName в конкретный элемент DOM, передавая необязательный объект с параметрами. Например:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// монтирует тег "users" в элемент #slide и передаёт в него объект api в качестве параметра
riot.mount(document.getElementById('slide'), 'users', api)
</code></pre></div></div>

<p>@returns: массив смонтированных <a href="#tag-instance">тегов</a></p>

<h3 id="-riotunregistertagname">
<a name="unregister"></a> riot.unregister(tagName)</h3>

<p>Отмена регистрации тега, ранее созданного с помощью компилятора или с помощью <code class="highlighter-rouge">riot.tag()</code>
  Этот метод может быть полезен в случае, если вам нужно протестировать ваше приложение и вы хотите создать несколько тегов, используя, например, одно и то же имя.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// создать тестовый тег</span>
<span class="nx">riot</span><span class="p">.</span><span class="nx">tag</span><span class="p">(</span><span class="s1">'test-tag'</span><span class="p">,</span> <span class="s1">'&lt;p&gt;{ message }&lt;/p&gt;'</span><span class="p">)</span>

<span class="c1">// смонтировать его</span>
<span class="kd">var</span> <span class="nx">tag</span> <span class="o">=</span> <span class="nx">riot</span><span class="p">.</span><span class="nx">mount</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">'div'</span><span class="p">),</span> <span class="s1">'test-tag'</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="nx">expect</span><span class="p">(</span><span class="nx">tag</span><span class="p">.</span><span class="nx">root</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">'p'</span><span class="p">)).</span><span class="nx">to</span><span class="p">.</span><span class="nx">be</span><span class="p">.</span><span class="nx">ok</span>

<span class="c1">// отменить регистрацию тега</span>
<span class="nx">riot</span><span class="p">.</span><span class="nx">unregister</span><span class="p">(</span><span class="s1">'test-tag'</span><span class="p">)</span>

<span class="c1">// воссоздать тот же тег, используя другой шаблон</span>
<span class="nx">riot</span><span class="p">.</span><span class="nx">tag</span><span class="p">(</span><span class="s1">'test-tag'</span><span class="p">,</span> <span class="s1">'&lt;div&gt;{ message }&lt;/div&gt;'</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="rendering">Рендеринг</h2>

<h3 id="-riotrendertagname-opts">
<a name="render"></a> riot.render(tagName, [opts])</h3>

<p>Рендерит пользовательский тег в html.<br>
<strong>Доступен только <em>на серверной стороне</em></strong> (Node/io.js). Например:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// рендерим "my-tag" в html
var mytag = require('my-tag')
riot.render(mytag, { foo: 'bar' })
</code></pre></div></div>

<p>@returns: строка html</p>

<h3 id="-riotrequiretagpath-opts">
<a name="mount-dom"></a> riot.require(tagPath, [opts])</h3>
<p>Запрашивает и компилирует теги riot во время выполнения.<br>
  <strong>Доступен только <em>на серверной стороне</em></strong> (Node/io.js).<br>
Он работает как и <code class="highlighter-rouge">require('./my-tag.tag')</code>, но дает вам возможность скомпилировать ваши теги, используя любые <a href="api-compiler#on-server">параметры компилятора</a>. Например, вы можете запросить тег и использовать препроцессор одновременно.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">tag</span> <span class="o">=</span> <span class="nx">riot</span><span class="p">.</span><span class="nx">require</span><span class="p">(</span><span class="s1">'./my-tag.jade'</span><span class="p">,</span> <span class="p">{</span> <span class="na">template</span><span class="p">:</span> <span class="s1">'jade'</span> <span class="p">})</span>
</code></pre></div></div>

<p>@returns: имя тега</p>

<h3 id="-riotrenderasynctagname-opts">
<a name="renderasync"></a> riot.renderAsync(tagName, [opts])</h3>

<p>Асинхронно рендерит пользовательский тег в html.<br>
<strong>Доступен только <em>на серверной стороне</em></strong> (Node/io.js).<br>
Этот метод возвращает обещание, которое будет разрешено только тогда, когда ваши теги вызовут событие “ready” во время процесса монтирования. Например:</p>

<h4 id="on-the-server">На сервере:</h4>
<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">riot</span><span class="p">.</span><span class="nx">renderAsync</span><span class="p">(</span><span class="nx">tagName</span><span class="p">,</span> <span class="nx">opts</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">html</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// делает что-то с вашим html</span>
  <span class="p">})</span>
  <span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Ошибка времени выполения!</span>
  <span class="p">})</span>
</code></pre></div></div>

<h4 id="in-your-tag">Ваш тег:</h4>
<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;async-rendering&gt;</span>
  <span class="nt">&lt;p&gt;</span>{ message }<span class="nt">&lt;/p&gt;</span>

  <span class="nt">&lt;script&gt;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">message</span> <span class="o">=</span> <span class="s1">'hi'</span>

    <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="c1">// запуск события "ready" если обещание разрешено</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">'ready'</span><span class="p">)</span>
    <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">),</span> <span class="mi">500</span><span class="p">)</span>
  <span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;/async-rendering&gt;</span>
</code></pre></div></div>

<p>Важно отметить, что если событие “ready” не будет запущено, обещание будет отклонено через 1 секунду. Вы можете настроить тайм-аут внутренних обещаний riot, с помощью  <code class="highlighter-rouge">riot.settings.asyncRenderTimeout</code> (по умолчанию 1000ms)</p>

<p>@returns: Обещание (Promise)</p>

<h2 id="tag-instance">Экземпляр тега</h2>

<p>Следующие свойства установлены для каждого экземпляра тега:</p>

<ul>
  <li>
<code class="highlighter-rouge">opts</code> - объект параметров</li>
  <li>
<code class="highlighter-rouge">refs</code> - элементы DOM для кеширования</li>
  <li>
<code class="highlighter-rouge">parent</code> - родительский тег, если есть</li>
  <li>
<code class="highlighter-rouge">root</code> - корневой элементы DOM, к которому примонтирован тег</li>
  <li>
<code class="highlighter-rouge">tags</code> - вложенные пользовательские теги</li>
</ul>

<p>Вы можете использовать эти свойства как в HTML, так и в JavaScript. Например:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;my-tag&gt;</span>
  <span class="nt">&lt;h3&gt;</span>{ opts.title }<span class="nt">&lt;/h3&gt;</span>

  var title = opts.title
<span class="nt">&lt;/my-tag&gt;</span>
</code></pre></div></div>

<p>Вы можете свободно устанавливать любые данные для экземпляра тега (называемого “контекст”), и они будут доступны в выражениях HTML. Например:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;my-tag&gt;</span>
  <span class="nt">&lt;h3&gt;</span>{ title }<span class="nt">&lt;/h3&gt;</span>

  this.title = opts.title
<span class="nt">&lt;/my-tag&gt;</span>
</code></pre></div></div>

<p>Примечание: если у вас есть глобальные переменные, вы также можете использовать эти ссылки как в HTML, так и в JavaScript-коде:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">window</span><span class="p">.</span><span class="nx">someGlobalVariable</span> <span class="o">=</span> <span class="s1">'Hello!'</span>
</code></pre></div></div>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;my-tag&gt;</span>
  <span class="nt">&lt;h3&gt;</span>{ someGlobalVariable }<span class="nt">&lt;/h3&gt;</span>

  var message = someGlobalVariable
<span class="nt">&lt;/my-tag&gt;</span>
</code></pre></div></div>

<h2 id="updating">Обновление</h2>

<h3 id="-thisupdate">
<a name="tag-update"></a>this.update()</h3>

<p>Обновляет все выражения в текущем экземпляре тега и во всех его дочерних компонентах. Этот метод вызывается автоматически каждый раз, когда вызывается обработчик события, например, когда пользователь взаимодействует с приложением.</p>

<p>Вы можете отменить автоматическое обновление, установив свойство <code class="highlighter-rouge">preventUpdate = true</code> для вашего объекта события, например:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;my-tag&gt;</span>
  <span class="nt">&lt;button</span> <span class="na">onclick=</span><span class="s">{</span> <span class="na">click</span> <span class="err">}</span><span class="nt">&gt;</span>{ message }<span class="nt">&lt;/button&gt;</span>

  <span class="nt">&lt;script&gt;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">message</span> <span class="o">=</span> <span class="s1">'hi'</span>

    <span class="nx">click</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">e</span><span class="p">.</span><span class="nx">preventUpdate</span> <span class="o">=</span> <span class="kc">true</span> <span class="c1">// ваш тег не будет обновляться автоматически</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">message</span> <span class="o">=</span> <span class="s1">'goodbye'</span>
    <span class="p">}</span>
  <span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;/my-tag&gt;</span>
</code></pre></div></div>

<p>Riot не обновляет пользовательский интерфейс автоматически, поэтому вам нужно вызвать этот метод вручную. Обычно это происходит после некоторого события, не связанного с пользовательским интерфейсом: после <code class="highlighter-rouge">setTimeout</code>, вызова AJAX или какого-либо события сервера. Например:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;my-tag&gt;</span>

  <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">"username"</span> <span class="na">onblur=</span><span class="s">{</span> <span class="na">validate</span> <span class="err">}</span><span class="nt">&gt;</span>
  <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"tooltip"</span> <span class="na">show=</span><span class="s">{</span> <span class="na">error</span> <span class="err">}</span><span class="nt">&gt;</span>{ error }<span class="nt">&lt;/span&gt;</span>

  <span class="nt">&lt;script&gt;</span>
    <span class="nx">validate</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">$</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="s1">'/validate/username/'</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">username</span><span class="p">.</span><span class="nx">value</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">fail</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">error_message</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">error</span> <span class="o">=</span> <span class="nx">error_message</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">update</span><span class="p">()</span>
        <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">))</span>
    <span class="p">}</span>
  <span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;/my-tag&gt;</span>
</code></pre></div></div>

<p>В приведенном выше примере, сообщение об ошибке отображается в пользовательском интерфейсе после вызова метода <code class="highlighter-rouge">update()</code>. (Мы можем продолжать использовать <code class="highlighter-rouge">this</code> ссылаясь на наш экземпляра тега, потому что мы использовали метод <code class="highlighter-rouge">.bind(this)</code> для обработчика ошибок <code class="highlighter-rouge">fail</code>)</p>

<p>Если вы хотите больше контролировать обновления тегов DOM, вы можете установить пользовательскую функцию <code class="highlighter-rouge">shouldUpdate</code>, и ваш тег будет обновляться только в том случае, если эта функция вернёт <code class="highlighter-rouge">true</code></p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;my-tag&gt;</span>
  <span class="nt">&lt;button</span> <span class="na">onclick=</span><span class="s">{</span> <span class="na">click</span> <span class="err">}</span><span class="nt">&gt;</span>{ message }<span class="nt">&lt;/button&gt;</span>

  <span class="nt">&lt;script&gt;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">message</span> <span class="o">=</span> <span class="s1">'hi'</span>

    <span class="nx">click</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">message</span> <span class="o">=</span> <span class="s1">'goodbye'</span>
    <span class="p">}</span>
    <span class="c1">// первый параметр, это данные, которые вы передаёте в метод обновления</span>
    <span class="c1">// при вызове this.update(), он будет иметь значение undefined</span>
    <span class="nx">shouldUpdate</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">nextOpts</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// не обновлять</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">message</span> <span class="o">===</span> <span class="s1">'goodbye'</span><span class="p">)</span> <span class="k">return</span> <span class="kc">false</span>
      <span class="c1">// если this.message отличается от 'goodbye', то мы можем обновить тег</span>
      <span class="k">return</span> <span class="kc">true</span>
    <span class="p">}</span>
  <span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;/my-tag&gt;</span>
</code></pre></div></div>

<p>Метод <code class="highlighter-rouge">shouldUpdate</code> всегда получает 2 аргумента: первый из них содержит значения , которые вы хотите обновить с помощью метода <code class="highlighter-rouge">tag.update</code>, а второй аргумент содержит новые параметры, полученные с помощью атрибутов тегов и, как правило, хранящиеся в объекте<code class="highlighter-rouge">opts</code>.</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;my-tag&gt;</span>
  <span class="nt">&lt;child-tag</span> <span class="na">message=</span><span class="s">{</span> <span class="na">message</span> <span class="err">}</span><span class="nt">&gt;&lt;/child-tag&gt;</span>
  <span class="nt">&lt;button</span> <span class="na">onclick=</span><span class="s">{</span> <span class="na">click</span> <span class="err">}</span><span class="nt">&gt;</span>Say goodbye<span class="nt">&lt;/button&gt;</span>

  <span class="nt">&lt;script&gt;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">message</span> <span class="o">=</span> <span class="s1">'hi'</span>

    <span class="nx">click</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">message</span> <span class="o">=</span> <span class="s1">'goodbye'</span>
    <span class="p">}</span>
  <span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;/my-tag&gt;</span>

<span class="nt">&lt;child-tag&gt;</span>
  <span class="nt">&lt;p&gt;</span>{ opts.message }<span class="nt">&lt;/p&gt;</span>

  <span class="nt">&lt;script&gt;</span>
    <span class="nx">shouldUpdate</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">nextOpts</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// обновить DOM в зависимости от полученных параметров</span>
      <span class="k">return</span> <span class="nx">nextOpts</span><span class="p">.</span><span class="nx">message</span> <span class="o">!==</span> <span class="s1">'goodbye'</span>
    <span class="p">}</span>
  <span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;/child-tag&gt;</span>
</code></pre></div></div>

<h3 id="-thisupdatedata">
<a name="tag-update-data"></a> this.update(data)</h3>

<p>Устанавливает значения свойств текущего элемента и обновляет выражения. Равнозначен <code class="highlighter-rouge">this.update()</code>, но позволяет вам одновременно передавать контекстные данные. Например, вместо этого:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">self</span><span class="p">.</span><span class="nx">error</span> <span class="o">=</span> <span class="nx">error_message</span>
<span class="nb">self</span><span class="p">.</span><span class="nx">update</span><span class="p">()</span>
</code></pre></div></div>

<p>вы можете сделать так:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">self</span><span class="p">.</span><span class="nx">update</span><span class="p">({</span> <span class="na">error</span><span class="p">:</span> <span class="nx">error_message</span> <span class="p">})</span>
</code></pre></div></div>

<p>что выглядит чище и короче.</p>

<h3 id="-riotupdate">
<a name="update"></a> riot.update()</h3>

<p>Обновляет все смонтированные теги и их выражения на странице.</p>

<p>@returns: массив смонтированных <a href="#tag-instance">тегов</a></p>

<h2 id="unmounting">Размонтирование</h2>

<h3 id="-thisunmountkeeptheparent">
<a name="tag-unmount"></a> this.unmount(keepTheParent)</h3>

<p>Отсоединяет тег и его дочерние элементы от страницы и запускает событие “unmount”.
Если вы хотите размонтировать тег без удаления родительского тега, вам нужно передать параметр <code class="highlighter-rouge">true</code> при вызове этого метода.</p>

<p>Удаляет тег из DOM:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">mytag</span><span class="p">.</span><span class="nx">unmount</span><span class="p">()</span>
</code></pre></div></div>

<p>Удаляет всех потомков и оставляет только родительский тег:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">mytag</span><span class="p">.</span><span class="nx">unmount</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="nested-tags">Вложенные теги</h2>

<p>У вас есть доступ к вложенным тегам через свойство <code class="highlighter-rouge">tags</code>:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;my-tag&gt;</span>

  <span class="nt">&lt;child&gt;&lt;/child&gt;</span>
  <span class="nt">&lt;script&gt;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'mount'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="c1">// доступ к вложенному тегу</span>
      <span class="kd">var</span> <span class="nx">child</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tags</span><span class="p">.</span><span class="nx">child</span>
    <span class="p">})</span>
  <span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;/my-tag&gt;</span>
</code></pre></div></div>

<p>Если вложенных тегов больше одного, они помещаются в массив <code class="highlighter-rouge">this.tags.child[n]</code></p>

<p>Вы также можете использовать атрибут <code class="highlighter-rouge">ref</code>, чтобы задать другое имя для вложенного тега. При этом, доступ осуществляется через свойство <code class="highlighter-rouge">refs</code>:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;my-tag&gt;</span>

  <span class="nt">&lt;child</span> <span class="na">ref=</span><span class="s">"my_nested_tag"</span><span class="nt">&gt;&lt;/child&gt;</span>

  <span class="nt">&lt;script&gt;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'mount'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="c1">// доступ к вложенному тегу</span>
      <span class="kd">var</span> <span class="nx">child</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">refs</span><span class="p">.</span><span class="nx">my_nested_tag</span>
    <span class="p">})</span>
  <span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;/my-tag&gt;</span>
</code></pre></div></div>

<p>Вложенные теги инициализируются после родительского тега, поэтому их методы и свойства доступны в событии  “mount”.</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;my-tag&gt;</span>

  <span class="nt">&lt;child</span> <span class="na">ref=</span><span class="s">"my_nested_tag"</span><span class="nt">&gt;&lt;/child&gt;</span>

  <span class="nt">&lt;script&gt;</span>
    <span class="c1">// доступ к методам вложенного тега</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'mount'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">refs</span><span class="p">.</span><span class="nx">my_nested_tag</span><span class="p">.</span><span class="nx">someMethod</span><span class="p">()</span>
      <span class="c1">// доступ через this.tags.child.someMethod() тоже работает</span>
    <span class="p">})</span>
  <span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;/my-tag&gt;</span>
</code></pre></div></div>

<h2 id="-yielding-nested-html">
<a name="yield"></a>Встраивание HTML в тег</h2>

<p>Тег <code class="highlighter-rouge">&lt;yield&gt;</code> является специальной базовой функцией, которая позволяет вам вставлять и компилировать содержимое любого пользовательского тега внутри его шаблона во время выполнения. Например, у нас есть тег <code class="highlighter-rouge">my-post</code></p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;my-post&gt;</span>
  <span class="nt">&lt;h1&gt;</span>{ opts.title }<span class="nt">&lt;/h1&gt;</span>
  <span class="nt">&lt;yield/&gt;</span>

  <span class="nt">&lt;script&gt;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="mi">777</span>
  <span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;/my-post&gt;</span>
</code></pre></div></div>

<p>в любой момент, мы подключаем тег <code class="highlighter-rouge">&lt;my-post&gt;</code> в нашем приложении</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;my-post</span> <span class="na">title=</span><span class="s">"What a great title"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;p</span> <span class="na">id=</span><span class="s">"my-content-{ id }"</span><span class="nt">&gt;</span>My beautiful post is just awesome<span class="nt">&lt;/p&gt;</span>
<span class="nt">&lt;/my-post&gt;</span>
</code></pre></div></div>

<p>после монтирования <code class="highlighter-rouge">riot.mount('my-post')</code>, он будет отображаться следующим образом:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;my-post&gt;</span>
  <span class="nt">&lt;h1&gt;</span>What a great title<span class="nt">&lt;/h1&gt;</span>
  <span class="nt">&lt;p</span> <span class="na">id=</span><span class="s">"my-content-777"</span><span class="nt">&gt;</span>My beautiful post is just awesome<span class="nt">&lt;/p&gt;</span>
<span class="nt">&lt;/my-post&gt;</span>
</code></pre></div></div>

<p><span class="tag red">Внимание</span> Результаты выражений <strong>всегда будут вычисляться исходя из контекста, в котором они используются</strong>. Например:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">&lt;!-- Создаём дочерний тег, в который можно будет передать какое-то содержимое --&gt;</span>
<span class="nt">&lt;child-tag&gt;&lt;yield/&gt;&lt;/child-tag&gt;</span>

<span class="nt">&lt;my-tag&gt;</span>
  <span class="nt">&lt;child-tag&gt;</span>
    <span class="c1">// обратите внимание, что при передачи содержимого, мы используем { parent.message }</span>
    <span class="c1">// а не просто { message }, потому что выражение вычисляется в контексте тега <span class="o">&lt;</span><span class="nx">child</span><span class="o">-</span><span class="nx">tag</span><span class="o">&gt;</span> <span class="nx"></span></span>
    <span class="nt">&lt;p&gt;</span>{ parent.message }<span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;/child-tag&gt;</span>
  <span class="nt">&lt;script&gt;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">message</span> <span class="o">=</span> <span class="s1">'hi'</span>
  <span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;/my-tag&gt;</span>
</code></pre></div></div>

<h4 id="multi-transclusion">Многослотовая поддержка</h4>

<p>Тег <code class="highlighter-rouge">&lt;yield&gt;</code>поддерживает механизм слот, который позволяет вводить разный HTML в специальные слоты в шаблоне</p>

<p>Например, у нас есть тег <code class="highlighter-rouge">my-other-post</code></p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;my-other-post&gt;</span>
  <span class="nt">&lt;article&gt;</span>
    <span class="nt">&lt;h1&gt;</span>{ opts.title }<span class="nt">&lt;/h1&gt;</span>
    <span class="nt">&lt;h2&gt;&lt;yield</span> <span class="na">from=</span><span class="s">"summary"</span><span class="nt">/&gt;&lt;/h2&gt;</span>
    <span class="nt">&lt;div&gt;</span>
      <span class="nt">&lt;yield</span> <span class="na">from=</span><span class="s">"content"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/article&gt;</span>
<span class="nt">&lt;/my-other-post&gt;</span>
</code></pre></div></div>

<p>в любой момент, мы подключаем тег <code class="highlighter-rouge">&lt;my-other-post&gt;</code> в нашем приложении</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;my-other-post</span> <span class="na">title=</span><span class="s">"What a great title"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;yield</span> <span class="na">to=</span><span class="s">"summary"</span><span class="nt">&gt;</span>
    My beautiful post is just awesome
  <span class="nt">&lt;/yield&gt;</span>
  <span class="nt">&lt;yield</span> <span class="na">to=</span><span class="s">"content"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;p&gt;</span>And the next paragraph describes just how awesome it is<span class="nt">&lt;/p&gt;</span>
    <span class="nt">&lt;p&gt;</span>Very<span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;/yield&gt;</span>
<span class="nt">&lt;/my-other-post&gt;</span>
</code></pre></div></div>

<p>после монтирования <code class="highlighter-rouge">riot.mount('my-other-post')</code>, он будет отображаться следующим образом:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;my-other-post&gt;</span>
  <span class="nt">&lt;article&gt;</span>
    <span class="nt">&lt;h1&gt;</span>What a great title<span class="nt">&lt;/h1&gt;</span>
    <span class="nt">&lt;h2&gt;</span>My beautiful post is just awesome<span class="nt">&lt;/h2&gt;</span>
    <span class="nt">&lt;div&gt;</span>
      <span class="nt">&lt;p&gt;</span>And the next paragraph describes just how awesome it is<span class="nt">&lt;/p&gt;</span>
      <span class="nt">&lt;p&gt;</span>Very<span class="nt">&lt;/p&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/article&gt;</span>
<span class="nt">&lt;/my-other-post&gt;</span>
</code></pre></div></div>

<h4 id="yield-and-loops">Yield и циклы</h4>

<p>Тег <code class="highlighter-rouge">&lt;yield&gt;</code> может быть использован в циклах или в дочерних тегах. Но вы должны быть внимательны, так как в этом случае <strong>всегда используются данные из дочерних тегов</strong>.</p>

<p>Имеем компонент <code class="highlighter-rouge">blog.tag</code></p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;blog&gt;</span>
  <span class="nt">&lt;h1&gt;</span>{ title }<span class="nt">&lt;/h1&gt;</span>
  <span class="nt">&lt;my-post</span> <span class="na">each=</span><span class="s">{</span> <span class="na">posts</span> <span class="err">}</span><span class="nt">&gt;</span>
    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">{</span> <span class="na">this</span><span class="err">.</span><span class="na">parent</span><span class="err">.</span><span class="na">backToHome</span> <span class="err">}</span><span class="nt">&gt;</span>Back to home<span class="nt">&lt;/a&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">onclick=</span><span class="s">{</span> <span class="na">this</span><span class="err">.</span><span class="na">parent</span><span class="err">.</span><span class="na">deleteAllPosts</span> <span class="err">}</span><span class="nt">&gt;</span>Delete all the posts<span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/my-post&gt;</span>

  <span class="nt">&lt;script&gt;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">backToHome</span> <span class="o">=</span> <span class="s1">'/homepage'</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">title</span> <span class="o">=</span> <span class="s1">'my blog title'</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">posts</span> <span class="o">=</span> <span class="p">[</span>
      <span class="p">{</span> <span class="na">title</span><span class="p">:</span> <span class="s2">"post 1"</span><span class="p">,</span> <span class="na">description</span><span class="p">:</span> <span class="s1">'my post description'</span> <span class="p">},</span>
      <span class="p">{</span> <span class="na">title</span><span class="p">:</span> <span class="s2">"post 2"</span><span class="p">,</span> <span class="na">description</span><span class="p">:</span> <span class="s1">'my post description'</span> <span class="p">}</span>
    <span class="p">]</span>

    <span class="nx">deleteAllPosts</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">posts</span> <span class="o">=</span> <span class="p">[]</span>

      <span class="c1">// нам нужно вручную запустить метод обновления</span>
      <span class="c1">// поскольку функция deleteAllPosts вызывается из дочернего тега,</span>
      <span class="c1">// автоматическое обновление родительского не происходит</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">update</span><span class="p">()</span>
    <span class="p">}</span>
  <span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;/blog&gt;</span>

<span class="nt">&lt;my-post&gt;</span>
  <span class="nt">&lt;h2&gt;</span>{ title }<span class="nt">&lt;/h2&gt;</span>
  <span class="nt">&lt;p&gt;</span>{ description }<span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;yield/&gt;</span>
<span class="nt">&lt;/my-post&gt;</span>
</code></pre></div></div>

<p>После компиляции, он будет выглядеть так:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;blog&gt;</span>
  <span class="nt">&lt;h1&gt;</span>my blog title<span class="nt">&lt;/h1&gt;</span>
  <span class="nt">&lt;my-post&gt;</span>
    <span class="nt">&lt;h2&gt;</span>post 1<span class="nt">&lt;/h2&gt;</span>
    <span class="nt">&lt;p&gt;</span>my post description<span class="nt">&lt;/p&gt;</span>
    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/homepage"</span><span class="nt">&gt;</span>Back to home<span class="nt">&lt;/a&gt;</span>
    <span class="nt">&lt;div&gt;</span>Delete all the posts<span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/my-post&gt;</span>
  <span class="nt">&lt;my-post&gt;</span>
    <span class="nt">&lt;h2&gt;</span>post 2<span class="nt">&lt;/h2&gt;</span>
    <span class="nt">&lt;p&gt;</span>my post description<span class="nt">&lt;/p&gt;</span>
    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/homepage"</span><span class="nt">&gt;</span>Back to home<span class="nt">&lt;/a&gt;</span>
    <span class="nt">&lt;div&gt;</span>Delete all the posts<span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/my-post&gt;</span>
<span class="nt">&lt;/blog&gt;</span>
</code></pre></div></div>

<h2 id="mixins">Примеси (Mixins)</h2>

<h3 id="-thismixinmixinobject">
<a name="mixin"></a> this.mixin(mixinObject)</h3>

<p>Расширяет текущий тег с помощью функциональности, доступной в mixinObject. Например:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">OptsMixin</span> <span class="o">=</span> <span class="p">{</span>
  <span class="c1">// специальный метод init вызывается</span>
  <span class="c1">// когда примесь загружается в тег</span>
  <span class="c1">// и не доступен из тега</span>
  <span class="c1">// `opts` является объектом параметров получаемых тегом
  </span>
  <span class="na">init</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">opts</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'updated'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Updated!'</span><span class="p">)</span> <span class="p">})</span>
  <span class="p">},</span>

  <span class="na">getOpts</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">opts</span>
  <span class="p">},</span>

  <span class="na">setOpts</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">opts</span><span class="p">,</span> <span class="nx">update</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">opts</span> <span class="o">=</span> <span class="nx">opts</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">update</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="nx">update</span><span class="p">()</span>
    <span class="k">return</span> <span class="k">this</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="o">&lt;</span><span class="nx">my</span><span class="o">-</span><span class="nx">tag</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="nx">h1</span><span class="o">&gt;</span><span class="p">{</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">title</span> <span class="p">}</span><span class="o">&lt;</span><span class="sr">/h1</span><span class="err">&gt;
</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">mixin</span><span class="p">(</span><span class="nx">OptsMixin</span><span class="p">)</span>
<span class="o">&lt;</span><span class="sr">/my-tag</span><span class="err">&gt;
</span></code></pre></div></div>

<h3 id="-riotmixinmixinname-mixinobject">
<a name="mixin-shared"></a> riot.mixin(mixinName, mixinObject)</h3>

<p>Регистрация общих примесей, доступных всем для использования в любом теге: <code class="highlighter-rouge">this.mixin(mixinName)</code>.</p>

<h3 id="-riotmixinmixinobject">
<a name="mixin-global"></a> riot.mixin(mixinObject)</h3>

<p>Регистрация глобальной примеси, которая автоматически добавляется во все экземпляры тегов.</p>

<h2 id="events">События</h2>

<p>Каждый экземпляр тега является  <a href="api-observable">observable</a>, поэтому вы можете использовать <code class="highlighter-rouge">on</code> и <code class="highlighter-rouge">one</code> методы для прослушивания событий, которые происходят в экземпляре тега. Вот список поддерживаемых событий:</p>

<ul>
  <li>“update” – прямо перед обновлением тега. Позволяет изменить данные тега перед тем, как выражения в шаблоне будут пересчитаны.</li>
  <li>“updated” – сразу после обновления тега. Позволяет манипулировать с обновлённым DOM-деревом.</li>
  <li>“before-mount” – перед тем, как тег будет смонтирован на странице.</li>
  <li>“mount” – сразу после того, как тег будет смонтирован на странице.</li>
  <li>“before-unmount” – перед удалением тега со страницы.</li>
  <li>“unmount” – после удаления тега со страницы.</li>
</ul>

<p>Например:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// очистка ресурсов после того, как тег больше не является частью DOM</span>
<span class="k">this</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'unmount'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">clearTimeout</span><span class="p">(</span><span class="nx">timer</span><span class="p">)</span>
<span class="p">})</span>
</code></pre></div></div>

<h2 id="reserved-words">Зарезервированные слова</h2>

<p>Приведённые выше имена методов и свойств являются зарезервированными словами для тегов Riot. Не используйте следующие названия для переменных тегов или их методов: <code class="highlighter-rouge">opts</code>, <code class="highlighter-rouge">parent</code>, <code class="highlighter-rouge">tags</code>, <code class="highlighter-rouge">root</code>, <code class="highlighter-rouge">refs</code>, <code class="highlighter-rouge">update</code>, <code class="highlighter-rouge">unmount</code>, <code class="highlighter-rouge">on</code>, <code class="highlighter-rouge">off</code>, <code class="highlighter-rouge">one</code> и <code class="highlighter-rouge">trigger</code>.  Переменные начинающиеся с подчеркивания (например: <code class="highlighter-rouge">this._item</code>), тоже зарезервированы для внутреннего использования. Локальные переменные можно называть как угодно. Например:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&lt;</span><span class="nx">my</span><span class="o">-</span><span class="nx">tag</span><span class="o">&gt;</span>

  <span class="c1">// можно</span>
  <span class="kd">function</span> <span class="nx">update</span><span class="p">()</span> <span class="p">{</span> <span class="p">}</span>

  <span class="c1">// нельзя</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">update</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="p">}</span>

  <span class="c1">// нельзя</span>
  <span class="nx">update</span><span class="p">()</span> <span class="p">{</span>

  <span class="p">}</span>

<span class="o">&lt;</span><span class="sr">/my-tag</span><span class="err">&gt;
</span></code></pre></div></div>

<h2 id="manual-construction">Создание тега вручную</h2>

<h3 id="-riottagtagname-html-css-attrs-constructor">
<a name="tag"></a> riot.tag(tagName, html, [css], [attrs], [constructor])</h3>

<p>Создаёт новый пользовательский тег “вручную”, без компилятора.</p>

<ul>
  <li>
<code class="highlighter-rouge">tagName</code> имя тега</li>
  <li>
<code class="highlighter-rouge">html</code> шаблон с <a href="guide#expressions">выражениями</a>
</li>
  <li>
<code class="highlighter-rouge">css</code> стили тега (необязательно)</li>
  <li>
<code class="highlighter-rouge">attrs</code> атрибуты тега (необязательно)</li>
  <li>
<code class="highlighter-rouge">constructor</code> функция, которая будет вызвана перед вычислением выражений и перед тем, как тег будет смонтирован</li>
</ul>

<h4 id="example">Пример</h4>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">riot</span><span class="p">.</span><span class="nx">tag</span><span class="p">(</span><span class="s1">'timer'</span><span class="p">,</span>
  <span class="s1">'&lt;p&gt;Seconds Elapsed: { time }&lt;/p&gt;'</span><span class="p">,</span>
  <span class="s1">'timer { display: block; border: 2px }'</span><span class="p">,</span>
  <span class="s1">'class="tic-toc"'</span><span class="p">,</span>
  <span class="kd">function</span> <span class="p">(</span><span class="nx">opts</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nb">self</span> <span class="o">=</span> <span class="k">this</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">time</span> <span class="o">=</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">start</span> <span class="o">||</span> <span class="mi">0</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">tick</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="nb">self</span><span class="p">.</span><span class="nx">update</span><span class="p">({</span> <span class="na">time</span><span class="p">:</span> <span class="o">++</span><span class="nb">self</span><span class="p">.</span><span class="nx">time</span> <span class="p">})</span>
    <span class="p">}</span>

    <span class="kd">var</span> <span class="nx">timer</span> <span class="o">=</span> <span class="nx">setInterval</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">tick</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'unmount'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="nx">clearInterval</span><span class="p">(</span><span class="nx">timer</span><span class="p">)</span>
    <span class="p">})</span>

  <span class="p">})</span>
</code></pre></div></div>

<p>Для получения более подробной информации, смотрите документацию по <a href="http://jsfiddle.net/gnumanth/h9kuozp5/">таймеру</a> и API <a href="api#tag-instance">riot.tag</a>.</p>

<p><span class="tag red">Внимание</span> при использовании <code class="highlighter-rouge">riot.tag</code>, вы не сможете воспользоваться преимуществами компилятора и список нижеперечисленных функций не поддерживается:</p>

<ol>
  <li>Самозакрывающиеся теги</li>
  <li>Выражения без кавычек. Пишите <code class="highlighter-rouge">attr="{ val }"</code> вместо <code class="highlighter-rouge">attr={ val }</code>
</li>
  <li>Короткий синтаксис методов ES6</li>
  <li>
<code class="highlighter-rouge">&lt;img src={ src }&gt;</code> должно быть написано так <code class="highlighter-rouge">&lt;img riot-src={ src }&gt;</code> для избежания некорректных запросов к серверу</li>
  <li>
<code class="highlighter-rouge">&lt;input value={ val }&gt;</code> должно быть написано так <code class="highlighter-rouge">&lt;img riot-value={ val }&gt;</code> для избежания неожиданных проблем с IE</li>
  <li>
<code class="highlighter-rouge">style="color: { color }"</code> должно быть написано так <code class="highlighter-rouge">riot-style="color: { color }"</code> чтобы выражения стилей работали в IE</li>
  <li>Препроцессоры CSS</li>
</ol>

<p>Вы можете использовать <code class="highlighter-rouge">&lt;template&gt;</code> или теги <code class="highlighter-rouge">&lt;script&gt;</code> следующим образом:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"tmpl"</span> <span class="na">id=</span><span class="s">"my_tmpl"</span><span class="nt">&gt;</span>
  <span class="o">&lt;</span><span class="nx">h3</span><span class="o">&gt;</span><span class="p">{</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">hello</span> <span class="p">}</span><span class="o">&lt;</span><span class="sr">/h3</span><span class="err">&gt;
</span>  <span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="nx">And</span> <span class="nx">a</span> <span class="nx">paragraph</span><span class="o">&lt;</span><span class="sr">/p</span><span class="err">&gt;
</span><span class="nt">&lt;/script&gt;</span>

<span class="nt">&lt;script&gt;</span>
<span class="nx">riot</span><span class="p">.</span><span class="nx">tag</span><span class="p">(</span><span class="s1">'tag-name'</span><span class="p">,</span> <span class="nx">my_tmpl</span><span class="p">.</span><span class="nx">innerHTML</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">opts</span><span class="p">)</span> <span class="p">{</span>

<span class="p">})</span>
<span class="nt">&lt;/script&gt;</span>
</code></pre></div></div>

<h4 id="tags-without-template">ТЕГИ БЕЗ ШАБЛОНА</h4>

<p><span class="tag red">&gt;=3.5.0</span></p>

<p>Начиная с версии 3.5, вы также можете создавать “теги-обёртки” без какого-либо шаблона, например:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">riot</span><span class="p">.</span><span class="nx">tag</span><span class="p">(</span><span class="s1">'tag-name'</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">opts</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">message</span> <span class="o">=</span> <span class="s1">'hi'</span>
<span class="p">})</span>

</code></pre></div></div>

<p>В этом случае, вы всегда сможете примонтировать тег с именем <code class="highlighter-rouge">tag-name</code>, оставляя разметку тега нетронутой и, вычисляя только выражения, содержащиеся в нём:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;body&gt;</span>
  <span class="nt">&lt;tag-name&gt;</span>
    <span class="nt">&lt;p&gt;</span>I want to say { message }<span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;/tag-name&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div>

<p>Этот способ может быть использован для улучшения шаблонов при рендеринге на стороне сервера. Он также позволит вам создавать новые шаблоны тегов, оборачивая независимые от логики дочерние компоненты взаимодействующие с тегами-обёртками, в которых вы сможете обрабатывать логику приложения:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;form-validator&gt;</span>
  <span class="nt">&lt;date-picker</span> <span class="na">onchange=</span><span class="s">{</span> <span class="na">updateDate</span> <span class="err">}</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;color-picker</span> <span class="na">onchange=</span><span class="s">{</span> <span class="na">pickAColor</span> <span class="err">}</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;errors-reporter</span> <span class="na">if=</span><span class="s">{</span> <span class="na">errors</span><span class="err">.</span><span class="na">length</span> <span class="err">}</span> <span class="na">errors=</span><span class="s">{</span> <span class="na">errors</span> <span class="err">}</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/form-validator&gt;</span>
</code></pre></div></div>

<h3 id="riottagel-opts">riot.Tag(el, [opts])</h3>

<p>Конструктор riot.Tag позволяет вам создавать и наследовать ваши теги, используя классы <code class="highlighter-rouge">es6</code>.
Если вы хотите создать свой тег, вам нужно наследовать конструктор <code class="highlighter-rouge">riot.Tag</code>:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nx">MyTag</span> <span class="kd">extends</span> <span class="nx">riot</span><span class="p">.</span><span class="nx">Tag</span> <span class="p">{</span>
  <span class="c1">// обязательно для того, чтобы использовать и идентифицировать этот компонент</span>
  <span class="kd">get</span> <span class="nx">name</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s1">'my-tag'</span>
  <span class="p">}</span>
  <span class="kd">get</span> <span class="nx">tmpl</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s2">`&lt;p onclick="{ click }"&gt;{ message }, Dear user&lt;/p&gt;`</span>
  <span class="p">}</span>
  <span class="kd">get</span> <span class="nx">attrs</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s1">'class="{ className }"'</span>
  <span class="p">}</span>
  <span class="kd">get</span> <span class="nx">css</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s1">'my-tag p{ color: blue; }'</span>
  <span class="p">}</span>
  <span class="nx">onCreate</span><span class="p">(</span><span class="nx">opts</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">message</span> <span class="o">=</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">message</span>
  <span class="p">}</span>
  <span class="nx">click</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">message</span> <span class="o">=</span> <span class="s1">'goodbye'</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">new</span> <span class="nx">MyTag</span><span class="p">(</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">'my-div'</span><span class="p">),</span>
  <span class="p">{</span> <span class="na">message</span><span class="p">:</span> <span class="s1">'hi'</span> <span class="p">}</span>
<span class="p">).</span><span class="nx">mount</span><span class="p">()</span>
</code></pre></div></div>

<p>Вы также можете комбинировать свои теги, наследуя их, начиная с общего предка:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nx">Logger</span> <span class="kd">extends</span> <span class="nx">riot</span><span class="p">.</span><span class="nx">Tag</span> <span class="p">{</span>
  <span class="kd">get</span> <span class="nx">name</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s1">'logger'</span>
  <span class="p">}</span>
  <span class="kd">get</span> <span class="nx">tmpl</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s2">`&lt;div&gt;{ opts.log }&lt;/div&gt;`</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nx">ErrorLogger</span> <span class="kd">extends</span> <span class="nx">Logger</span> <span class="p">{</span>
  <span class="kd">get</span> <span class="nx">name</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s1">'error-logger'</span>
  <span class="p">}</span>
  <span class="kd">get</span> <span class="nx">css</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s1">'error-logger div { color: red; }'</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nx">SuccessLogger</span> <span class="kd">extends</span> <span class="nx">Logger</span> <span class="p">{</span>
  <span class="kd">get</span> <span class="nx">name</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s1">'success-logger'</span>
  <span class="p">}</span>
  <span class="kd">get</span> <span class="nx">css</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s1">'success-logger div { color: green; }'</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">new</span> <span class="nx">ErrorLogger</span><span class="p">(</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">'.error'</span><span class="p">),</span>
  <span class="p">{</span> <span class="na">log</span><span class="p">:</span> <span class="s1">'oups!!!'</span> <span class="p">}</span>
<span class="p">).</span><span class="nx">mount</span><span class="p">()</span>

<span class="k">new</span> <span class="nx">SuccessLogger</span><span class="p">(</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">'.success'</span><span class="p">),</span>
  <span class="p">{</span> <span class="na">log</span><span class="p">:</span> <span class="s1">'well done!!!'</span> <span class="p">}</span>
<span class="p">).</span><span class="nx">mount</span><span class="p">()</span>
</code></pre></div></div>

</section>