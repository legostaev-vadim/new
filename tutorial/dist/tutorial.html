<h2 id="-riot-js">Простое приложение на Riot.js</h2>
<p><img src="https://riot.js.org/img/logo/riot120x.png" alt="Riot"></p>
<blockquote>
<p>Данное руководство распространяется совершенно бесплатно и без каких-либо ограничений. Авторство остаётся за сайтом <a href="http://riot-js.ru">riot-js.ru</a>.</p>
</blockquote>
<div id="toc">
  <p><a href="#preparatory-work">Подготовительные работы</a></p>
  <p><a href="#configuration-file">Создание файла конфигурации Webpack</a></p>
  <p><a href="#create-component-hello">Создание компонента Hello</a></p>
  <p><a href="#storage-module">Модуль хранения состояния</a></p>
  <p><a href="#create-component-userlist">Создание компонента UserList</a></p>
</div>


<p><em>Давайте разработаем простое приложение, которое охватывает некоторые основные аспекты одностраничных приложений. Мы пройдём вес цикл разработки и в конечном итоге, создадим небольшое приложение использующее <a href="https://ru.wikipedia.org/wiki/REST">REST</a> API и реализующее все основные операции <a href="https://ru.wikipedia.org/wiki/CRUD">CRUD</a> (Создание, Чтение, Обновление и Удаление). Для работы мы будем использовать <a href="https://riot.js.org/">Riot</a> версии <strong>3.13.2</strong> (на момент написания руководства), <a href="https://webpack.js.org/">Webpack</a> последней версии и <a href="https://nodejs.org/en/">Node.js</a> должен быть у вас установлен.</em></p>
<h3 id="preparatory-work">Подготовительные работы</h3>

<p>Интерактивный пример работы нашего будущего приложения, вы можете увидеть здесь: <a href="http://272758.playcode.io/#!/list">Riot Application</a></p>
<p>Вначале, давайте создадим рабочую директорию и точку входа для нашего приложения. Создайте папку с названием <strong>app</strong>, а в ней создайте файл <strong>index.html</strong>:</p>
<pre><code class="language-html">&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
&lt;head&gt;
  &lt;meta charset=&quot;UTF-8&quot;&gt;
  &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;
  &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;ie=edge&quot;&gt;
  &lt;title&gt;Riot Application&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
  &lt;script src=&quot;dist/build.js&quot;&gt;&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
<p>Мы могли бы создать всё приложение в одном файле Javascript, но в дальнейшем, это затруднило бы навигацию по нашему коду. Вместо этого, давайте разделим код на модули и соберём эти модули в файл <strong>dist/build.js</strong>.</p>
<p>Перейдите в наш рабочий каталог <strong>app</strong>, затем откройте терминал командной строки, перейдите в эту папку в терминале и введите команду:</p>
<pre><code>npm init -y</code></pre><blockquote>
<p>Не забывайте в терминале переходить в папку <strong>app</strong>!</p>
</blockquote>
<p>Она создаст файл <strong>package.json</strong>, который содержит описание нашего проекта и управляет его зависимостями. Если вы всё сделали правильно, то вот так вот сейчас выглядит этот файл:</p>
<pre><code class="language-js">{
  &quot;name&quot;: &quot;app&quot;,
  &quot;version&quot;: &quot;1.0.0&quot;,
  &quot;description&quot;: &quot;&quot;,
  &quot;main&quot;: &quot;index.js&quot;,
  &quot;scripts&quot;: {
    &quot;test&quot;: &quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;
  },
  &quot;keywords&quot;: [],
  &quot;author&quot;: &quot;&quot;,
  &quot;license&quot;: &quot;ISC&quot;
}</code></pre>
<p>Давайте заменим в этом файле содержимое секции <strong>scripts</strong>, и вместо:</p>
<pre><code class="language-js">&quot;test&quot;: &quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</code></pre>
<p>пропишем:</p>
<pre><code class="language-js">&quot;dev&quot;: &quot;webpack-dev-server -d --open&quot;,
&quot;build&quot;: &quot;webpack -p&quot;</code></pre>
<p>Теперь наш файл должен выглядеть так:</p>
<pre><code class="language-js">{
  &quot;name&quot;: &quot;app&quot;,
  &quot;version&quot;: &quot;1.0.0&quot;,
  &quot;description&quot;: &quot;&quot;,
  &quot;main&quot;: &quot;index.js&quot;,
  &quot;scripts&quot;: {
    &quot;dev&quot;: &quot;webpack-dev-server -d --open&quot;,
    &quot;build&quot;: &quot;webpack -p&quot;
  },
  &quot;keywords&quot;: [],
  &quot;author&quot;: &quot;&quot;,
  &quot;license&quot;: &quot;ISC&quot;
}</code></pre>
<p>Команда <strong>dev</strong> будет отвечать за запуск <strong>Webpack</strong> в режиме разработки, а команда <strong>build</strong> используется для продакшена. На этом, наши ручные манипуляции с файлом <strong>package.json</strong> можно считать законченными.</p>
<p>Для нашей задачи нам потребуется установить несколько пакетов. Сначала установим пакеты необходимые для разработки. Введите в терминале:</p>
<pre><code>npm i -D webpack webpack-cli webpack-dev-server</code></pre><p>Затем, установим пакеты для самого приложения:</p>
<pre><code>npm i -S riot riot-route</code></pre><p>Таким образом, наш файл <strong>package.json</strong> получит следующее содержимое:</p>
<pre><code class="language-js">{
  &quot;name&quot;: &quot;app&quot;,
  &quot;version&quot;: &quot;1.0.0&quot;,
  &quot;description&quot;: &quot;&quot;,
  &quot;main&quot;: &quot;index.js&quot;,
  &quot;scripts&quot;: {
    &quot;dev&quot;: &quot;webpack-dev-server -d --open&quot;,
    &quot;build&quot;: &quot;webpack -p&quot;
  },
  &quot;keywords&quot;: [],
  &quot;author&quot;: &quot;&quot;,
  &quot;license&quot;: &quot;ISC&quot;,
  &quot;devDependencies&quot;: {
    &quot;webpack&quot;: &quot;^4.29.6&quot;,
    &quot;webpack-cli&quot;: &quot;^3.3.0&quot;,
    &quot;webpack-dev-server&quot;: &quot;^3.2.1&quot;
  },
  &quot;dependencies&quot;: {
    &quot;riot&quot;: &quot;^3.13.2&quot;,
    &quot;riot-route&quot;: &quot;^3.1.4&quot;
  }
}</code></pre>
<p>Создадим в нашей папке <strong>app</strong> подпапку <strong>src</strong>, а в ней ещё три папки:</p>
<pre><code class="language-js">assets, models и views </code></pre>
<p>Структура нашего проекта примет следующий вид:</p>
<pre><code class="language-js">app/
    node_modules/
    src/
        assets/
        models/
        views/
    index.html
    package.json</code></pre>
<blockquote>
<p>Мы не создавали папку <strong>node_modules</strong>, она была создана <strong>npm</strong> (менеджер пакетов Node.js) автоматически, во время установки пакетов.</p>
</blockquote>
<p>На этом, подготовительные работы для нашего проекта закончены. Следующим этапом будет создание файла конфигурации для <strong>Webpack</strong> и пробный запуск приложения.</p>
<h3 id="configuration-file">Создание файла конфигурации Webpack</h3>

<p>В нашей папке <strong>app</strong> создайте файл <strong>webpack.config.js</strong> и введите в него следующий код:</p>
<pre><code class="language-js">const path = require(&#39;path&#39;)

module.exports = {
  entry: &#39;./src/App.js&#39;,
  output: {
    path: path.resolve(__dirname, &#39;dist&#39;),
    filename: &#39;build.js&#39;
  }
}</code></pre>
<blockquote>
<p>Точкой входа <strong>entry</strong> будет файл <strong>App.js</strong>, расположенный в папке <strong>src</strong>, а выводить <strong>output</strong> наш код мы будем в файл <strong>build.js</strong>, расположеный в папке <strong>dist</strong>.</p>
</blockquote>
<p>Создайте в папке <strong>src</strong> файл <strong>App.js</strong> и введите в него:</p>
<pre><code class="language-js">console.log(&#39;Hello Riot!&#39;)</code></pre>
<p>Структура нашего проекта к этому моменту имеет следующий вид:</p>
<pre><code class="language-js">app/
    node_modules/
    src/
        assets/
        models/
        views/
        App.js
    index.html
    package.json</code></pre>
<p>Сохраните файл и запустите терминал из папки <strong>app</strong>. В терминале введите:</p>
<pre><code>npm run dev</code></pre><p>После этого откроется страница в браузере, соответствующая файлу <strong>index.html</strong>. Перейдите в консоль браузера, там вы должны увидеть приветственное сообщение:</p>
<pre><code class="language-js">&gt; Hello Riot!</code></pre>
<p>Мы ещё не раз вернёмся к файлу <strong>webpack.config.js</strong>, а пока, вы можете его закрыть и перейти в папку <strong>views</strong>, где мы создадим наш первый компонент <strong>Hello</strong>, который будет выводить приветственное сообщение на странице.</p>
<h3 id="create-component-hello">Создание компонента Hello</h3>

<blockquote>
<p>Постарайтесь найти для своего редактора расширение, поддерживающие синтаксис <strong>riot</strong> в файлах <strong>.tag</strong>. Это сильно облегчит вам работу в дальнешей. Для редактора <a href="https://code.visualstudio.com/">Visual Studio Code</a>, такое <a href="https://github.com/crisward/riot-tag">дополнение</a> имеется.</p>
</blockquote>
<p>В папке <strong>views</strong> создайте файл <strong>Hello.tag</strong>. В данном файле будет распологаться наш компонент, который мы назовем <strong>r-hello</strong>.</p>
<blockquote>
<p>Все компоненты мы будем хранить в этой папке, поскольку они являются <strong>представлениями</strong>, что исходит из самого её названия.</p>
</blockquote>
<blockquote>
<p>Префикс <strong>r-</strong> не является обязательным в названии тега компонента. Этим действием, мы лишь показываем его принадлежность к пользовательским тегам <strong>Riot</strong> и, одновременно, избегаем пересечения в пространстве имён со стандартными <strong>html-элементами</strong>, наподобие <strong>header</strong>. Например, если бы нам потребовался компонент <strong>header</strong>, то мы назвали бы его <strong>r-header</strong>.</p>
</blockquote>
<p>В файле <strong>Hello.tag</strong> введите:</p>
<pre><code class="language-html">&lt;r-hello&gt;
  &lt;h1&gt;Hello Riot!&lt;/h1&gt;
&lt;/r-hello&gt;</code></pre>
<p>Затем, откройте файл <strong>App.js</strong>, закомментируйте или удалите приветствие, и подключите наш тег к приложению:</p>
<pre><code class="language-js">// подключаем тег в приложение
import &#39;./views/Hello.tag&#39;</code></pre>
<blockquote>
<p>Точка в начале названия пути <strong>&#39;./views/Hello.tag&#39;</strong>, указывает на его относительную принадлежность.</p>
</blockquote>
<p>Нам <strong>не требуется</strong> импортировать наш тег в переменную, вида:</p>
<pre><code class="language-js">import Hello from &#39;./views/Hello.tag&#39;</code></pre>
<p>поскольку файлы компонентов <strong>не содержат</strong> ни какого экспорта. Мы импортируем тег прямо в файл.</p>
<p>Если мы сейчас попытаемся запустить <strong>Webpack</strong> командой:</p>
<pre><code>npm run dev</code></pre><p>то неизбежно получим сообщение об ошибке синтаксического разбора:</p>
<pre><code>ERROR in ./src/views/Hello.tag 1:0
Module parse failed: Unexpected token (1:0)
You may need an appropriate loader to handle this file type.
&gt; &lt;r-hello&gt;
|   &lt;h1&gt;Hello Riot!&lt;/h1&gt;
| &lt;/r-hello&gt;
 @ ./src/App.js 2:0-26
 @ multi (webpack)-dev-server/client?http://localhost:8080 ./src/App.js</code></pre><p>Из которого можно сделать вывод, что нам потребуется установить соответствующий <strong>загрузчик Webpack</strong>.</p>
<blockquote>
<p>Несмотря на ошибку, <strong>Webpack</strong> не завершает своё выполнение в терминале. Остановить его работу можно командой <strong>Ctrl+C</strong></p>
</blockquote>
<p>Мы будем использовать загрузчик <a href="https://www.npmjs.com/package/riot-tag-new-loader">riot-tag-new-loader</a>.</p>
<p>Откройте терминал из папки <strong>app</strong> или переведите терминал в неё другим способом, и введите команду:</p>
<pre><code>npm i -D riot-tag-new-loader</code></pre><blockquote>
<p>Флаг <strong>-D</strong> указывает на зависимость <strong>devDependencies</strong>, которая используется для процесса разработки, а флаг <strong>-S</strong> на <strong>dependencies</strong>, в которой указываются пакеты, используемые для работы самого приложения.</p>
</blockquote>
<p>Наш файл <strong>package.json</strong> теперь выглядит так:</p>
<pre><code class="language-js">{
  &quot;name&quot;: &quot;app&quot;,
  &quot;version&quot;: &quot;1.0.0&quot;,
  &quot;description&quot;: &quot;&quot;,
  &quot;main&quot;: &quot;index.js&quot;,
  &quot;scripts&quot;: {
    &quot;dev&quot;: &quot;webpack-dev-server -d --open&quot;,
    &quot;build&quot;: &quot;webpack -p&quot;
  },
  &quot;keywords&quot;: [],
  &quot;author&quot;: &quot;&quot;,
  &quot;license&quot;: &quot;ISC&quot;,
  &quot;devDependencies&quot;: {
    &quot;riot-tag-new-loader&quot;: &quot;^1.0.14&quot;,
    &quot;webpack&quot;: &quot;^4.29.6&quot;,
    &quot;webpack-cli&quot;: &quot;^3.3.0&quot;,
    &quot;webpack-dev-server&quot;: &quot;^3.2.1&quot;
  },
  &quot;dependencies&quot;: {
    &quot;riot&quot;: &quot;^3.13.2&quot;,
    &quot;riot-route&quot;: &quot;^3.1.4&quot;
  }
}</code></pre>
<blockquote>
<p>Простая установка загрузчика, не избавит нас о вышеуказанной проблемы. Нам нужно будет добавить соответствующие <strong>правила</strong> в файле <strong>webpack.config.js</strong>.</p>
</blockquote>
<p>Откроем файл <strong>webpack.config.js</strong> и добавим новое правило в свойство <strong>rules</strong>:</p>
<pre><code class="language-js">const path = require(&#39;path&#39;)

module.exports = {
  entry: &#39;./src/App.js&#39;,
  output: {
    path: path.resolve(__dirname, &#39;dist&#39;),
    filename: &#39;build.js&#39;
  },
  // добавляем новое правило для файлов тегов (.tag)
  module: {
    rules: [
      {
        test: /\.tag$/,
        exclude: /(node_modules|bower_components)/,
        use: &#39;riot-tag-new-loader&#39;
      }
    ]
  }
}</code></pre>
<p>Если мы сейчас снова попытаемся запустить <strong>Webpack</strong>:</p>
<pre><code>npm run dev</code></pre><p>то ошибка исчезнет, но ничего интересного, кроме пустой страницы в браузере, мы не увидим.</p>
<blockquote>
<p>Загрузчик лишь компилирует содержимое файлов тегов в обычный <strong>JavaScript</strong>, который <strong>Webpack</strong> подключает к нашему приложению.</p>
</blockquote>
<p>Нам потребуется выполнить три завершающих действия:</p>
<ul>
<li>подключить <strong>riot.js</strong> к нашему приложению</li>
<li>передать <strong>riot.js</strong> тег <strong>Hello</strong> для монтирования</li>
<li>подключить тег к странице <strong>index.html</strong></li>
</ul>
<p>Откроем файл <strong>App.js</strong> и в самом верху, <strong>перед</strong> подключением тега, добавим команду импорта:</p>
<pre><code class="language-js">import riot from &#39;riot&#39;</code></pre>
<p>а в его конце, <strong>после</strong> команды подключения тега, добавим команду монтирования:</p>
<pre><code class="language-js">riot.mount(&#39;r-hello&#39;)</code></pre>
<p>Теперь наш файл <strong>App.js</strong> должен выглядеть вот так:</p>
<pre><code class="language-js">// подключаем riot.js в приложение
import riot from &#39;riot&#39;
// подключаем тег в приложение
import &#39;./views/Hello.tag&#39;

// передаём тег для монтирования в riot.js
riot.mount(&#39;r-hello&#39;)</code></pre>
<blockquote>
<p>Мы передаём <strong>riot.js</strong> название тега так, как мы указали его в файле <strong>Hello.tag</strong>, т.е. <strong>r-hello</strong>. Это же название мы будем использовать и при подключении тега на странице, а <strong>Hello.tag</strong> - это просто название файла, в котором хранится наш компонент.</p>
</blockquote>
<p>Откроем файл <strong>index.html</strong> и подключим тег в <strong>body</strong>:</p>
<pre><code class="language-html">&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
&lt;head&gt;
  &lt;meta charset=&quot;UTF-8&quot;&gt;
  &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;
  &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;ie=edge&quot;&gt;
  &lt;title&gt;Riot Application&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;

  &lt;!-- подключаем тег --&gt;
  &lt;r-hello /&gt;

  &lt;script src=&quot;build.js&quot;&gt;&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
<p>И вот теперь, мы снова можем запустить <strong>Webpack</strong>:</p>
<pre><code>npm run dev</code></pre><p>после чего откроется страница в браузере с приветственным сообщением:</p>
<h1 id="hello-riot-">Hello Riot!</h1>
<p>Мы можем менять наше сообщение в компоненте <strong>Hello</strong>, и браузер автоматически будет обновлять страницу.</p>
<p>Это достигается благодаря тому, что мы в самом начале установили <strong>webpack-dev-server</strong>, а за само открытие страницы в браузере, отвечает его флаг <strong>--open</strong> команды <strong>dev</strong> в секции <strong>scripts</strong> файла <strong>package.json</strong></p>
<pre><code class="language-js">&quot;scripts&quot;: {
  &quot;dev&quot;: &quot;webpack-dev-server -d --open&quot;,
  &quot;build&quot;: &quot;webpack -p&quot;
}</code></pre>
<p>На этом, мы заканчиваем с ознакомительной частью данного руководства и, уже в следующей части, перейдём непосредственно к написанию нашего приложения. И начнем мы с создания модуля для хранения нашего состояния.</p>
<h3 id="storage-module">Модуль хранения состояния</h3>

<p>В папке <strong>models</strong> создайте файл <strong>User.js</strong>. Наше состояние будет храниться в экземпляре класса <strong>User</strong>. Давайте создадим этот класс, который будет иметь два свойства для хранения данных:</p>
<pre><code class="language-js">export default class User {

  constructor(riot) {
    this.list = []
    this.current = {}
  }

}</code></pre>
<ul>
<li><strong>list</strong> - список пользователей</li>
<li><strong>current</strong> -  текущий пользователь</li>
</ul>
<blockquote>
<p>Заметьте, что мы используем <strong>экспорт по умолчанию</strong> для нашего класса. Это обычная практика при работе с модулями, содержащими один единственный класс для экспорта, что не отменяет одновременно и <strong>именованный экспорт</strong>, если в этом возникнет такая необходимость.</p>
</blockquote>
<p>Теперь давайте добавим код для загрузки некоторых данных с сервера. Для связи с сервером мы будем использовать <a href="https://developer.mozilla.org/ru/docs/Web/API/Fetch_API/Using_Fetch">Fetch</a> API, который является <a href="https://developer.mozilla.org/ru/docs/Web/API/XMLHttpRequest">XMLHttpRequest</a> нового поколения. Далее мы создадим функцию <strong>getUsers</strong>, которая будет запускать вызов XHR и получать список пользователей с сервера:</p>
<pre><code class="language-js">export default class User {

  constructor(riot) {
    this.list = []
    this.current = {}
  }

  getUsers() {

  }

}</code></pre>
<blockquote>
<p>В этом руководстве мы будем делать вызовы XHR для <a href="http://rem-rest-api.herokuapp.com/">REM</a> API, который является фиктивным <a href="https://ru.wikipedia.org/wiki/REST">REST</a> API для быстрого создания прототипов. Этот API возвращает список пользователей из конечной точки.</p>
</blockquote>
<p>Используя <strong>fetch</strong>, выполним XHR-запрос и заполним наш список <strong>list</strong> данными, из этой конечной точки.</p>
<pre><code class="language-js">export default class User {

  constructor(riot) {
    this.list = []
    this.current = {}
  }

  getUsers() {
    fetch(&#39;https://rem-rest-api.herokuapp.com/api/users&#39;, {
      method: &#39;GET&#39;,
      credentials: &#39;include&#39;
    })
      .then(response =&gt; response.json())
      .then(result =&gt; {
        this.list = result.data
      })
  }

}</code></pre>
<ul>
<li><strong>method</strong> - метод <a href="https://ru.wikipedia.org/wiki/HTTP">HTTP</a></li>
<li><strong>credentials</strong> - отвечает за <a href="https://ru.wikipedia.org/wiki/Cookie">Cookie</a></li>
</ul>
<p>В первом аргументе <strong>fetch</strong> передаётся url адрес для конечной точки API, второй аргумент представляет собой объект с параметрами запроса. В свойстве <strong>method</strong> этого объекта указываем <strong>GET</strong>, а для свойства <strong>credentials</strong> задаём значение <strong>include</strong>, которое указывает на то, что мы используем куки, поскольку это является обязательным требованием для <strong>REM API</strong>.</p>
<blockquote>
<p>Вызов <strong>fetch</strong> возвращает обещание (промис), который, когда ответ будет получен, выполняет функции обратного вызова с объектом <a href="https://developer.mozilla.org/ru/docs/Web/API/Response">Response</a> или с ошибкой, если запрос не удался. Объект <strong>response</strong> предоставляет методы, позволяющие прочитать тело ответа в необходимом нам формате. В нашем случае, сервер возвращает нам ответ в формате <strong>JSON</strong>, который, с помощью метода <strong>response.json()</strong>, в первом вызове <strong>.then</strong>, преобразуется в объект <strong>JavaScript</strong> и возвращается промис. Следующий <strong>.then</strong> присваивает полученные данные, которые представляют собой массив объектов, свойству <strong>list</strong> нашего объекта класса <strong>User</strong>.</p>
</blockquote>
<p>Теперь мы создадим компонет <strong>UserList</strong>, который является представлением для отображения данных из нашего модуля состояния.</p>
<h3 id="create-component-userlist">Создание компонента UserList</h3>

<p>Из папки <strong>views</strong>  удалите файл <strong>Hello.tag</strong>, поскольку компонент <strong>Hello</strong> нам больше не нужен. Удалите так же его подключение из файлов <strong>App.js</strong> и <strong>index.html</strong>. Вот так теперь они должны у вас выглядеть:</p>
<p><strong>App.js</strong></p>
<pre><code class="language-js">// подключаем riot.js в приложение
import riot from &#39;riot&#39;</code></pre>
<p><strong>index.html</strong></p>
<pre><code class="language-html">&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
&lt;head&gt;
  &lt;meta charset=&quot;UTF-8&quot;&gt;
  &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;
  &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;ie=edge&quot;&gt;
  &lt;title&gt;Riot Application&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
  &lt;script src=&quot;build.js&quot;&gt;&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
